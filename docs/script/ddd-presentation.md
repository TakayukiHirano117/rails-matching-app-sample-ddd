---
marp: true
theme: default
paginate: true
---

# ドメインモデリングとコードで理解する実践DDD入門

---

## 本日の内容📗

- **DDDとは**
- **なぜDDDなのか**
- **ドメインモデリングとは**
- **ドメインモデリングの結果をどうコードに落とすのか**

---

## 自己紹介

**フロントエンド推進チーム 平野 宇教**

- 24歳(今年でアラサーになることを中村さんにいじられ傷心中)
- IBRの開発をしている。IBRはDDD x オニオンアーキテクチャです。
- 以前は支援開発チームでIBJS, Leaf, smarry, kana, BN, IBRをやっていた。
- DDDなどの設計やアーキテクチャを勉強中、いい加減AIキャッチアップしたい。

---
## DDDとっつきにくくない？

- 専門用語やたら多い
- ハンズオンなどで実際に実装できる教材が少ない
- DDDの雰囲気が分かってもどうやってコードを書いていけばいいかわからない

.....etc

---

今日は、
できるだけ専門用語の説明は少なめ or わかりやすく噛み砕いて説明

モデリング & コードを通して

**「DDDおもしろそうじゃね？」**
**「DDDやったらこんないいことがあるんだ！」**

と思える回にしたい！！！！！

---

## このエンジニアゼミを終えたらできるようになること

- **DDDの基礎がわかる**
- **DDDの基本的な用語(エンティティ・値オブジェクト,,,etc)が何かわかる**
- **ドメインモデリングの手法がわかる**
- **ドメインモデル図をもとにしたドメインオブジェクトの実装方法がわかる**

---


## 今回扱わないこと

- **DDDで扱われるアーキテクチャの詳細な内容**
- **ドメイン層以外の実装について**
- **テストについて**
---

<!-- _class: center -->

![もろたでドメイン駆動 center width:100% height: 100%](imgs/morotadekudou1_R.jpeg)

---

# DDDとは

---

## DDDとは

**ドメイン駆動設計（Domain Driven Design）**

- **ソフトウェア設計手法の1つ**
- **ある領域に存在する特定の問題を解決することにフォーカスした設計手法**

ソフトウェアで問題解決しようとする対象領域のことを**ドメイン**と呼びます。

---

## DDDのアプローチ

DDDでは問題解決のために以下のアプローチを取ります：

- **ドメインについての理解を深めモデルを継続的に改善する**
- **モデルを継続的にソフトウェアに反映する**

---

![](imgs/ddd-approach.png)

---

## DDDが向いているソフトウェア

- 複雑なドメインを持つもの

**はまっち曰く6割くらいのソフトウェアはDDDでやれば大体うまくいく、らしい**

---
## DDDが向いていないもの

- 簡単なCRUD処理しかないもの(ただのTodoアプリなど)
- ソフトウェアの価値が技術的な複雑さにあるもの(プログラミング言語、コンパイラ、ストレージなど)

---

# なぜDDDなのか

---

## DDDの目的

ソフトウェアの

- **機能性**
  - ソフトウェアによる問題解決能力
  - ユーザーの要求を満たす力

- **保守性**

を高める。
他にもドメインの知識をドメイン層に記載することでコードのドキュメント化の作用も

---

## DDDでの機能性・保守性向上のためのアプローチ
DDDでは

- ドメインモデルを更新
- 実装パターン

により機能性・保守性を高める。

---
## **モデリングしないと意味がないわけではない!!!**
実装パターンだけを適用したものを**軽量DDDと呼ぶ**

モデリング・実装パターンの両方を取り入れるとより機能性・保守性が高まる。
軽量DDDが批判されることもあるがメリット・デメリットを理解した上での採用なら問題ない！

---

## DDDのサイクル

**モデリング → 実装 → フィードバック → モデリング...**

このサイクルを回すことで：
- **作ったけど使えない**という事態を避けることができる




---

# ドメインモデリングとは

---

## ドメインモデリング

**ドメインモデルを作る作業**

📘 **出典：Eric Evans『Domain-Driven Design』**

*"A model is a system of abstractions that describes selected aspects of a domain and can be used to solve problems related to that domain."*

**モデルとは、ドメインの特定の側面を抽象化したものであり、そのドメインに関する問題を解決するために使われる。**

---

## ドメインモデリングの例

**メモアプリの場合：**

現実のメモには...
- メモの内容
- 筆跡
- 字の大きさ  
- メモの材質

ソフトウェアでは...
- **メモの内容だけ**あれば十分

**必要な側面だけを現実の事象から抽出する**

---

## ドメインモデリングで大事なこと

- **最初から完璧なものを作ろうとしない**
- **モデリング→実装→フィードバック→モデリング**のサイクルを回す
- **実装して初めて気づくこともある**

---

## ドメインエキスパート

**そのドメインに詳しい人**

例：
- 経費精算システム → 経理部の人
- マッチングアプリ → 今回はChatGPTを活用

---

## ドメインモデリングの結果をコードに落とす

---

## 言語

**言語：Ruby/Rails**
- IBJのエンジニアが最もとっつきやすいであろう
- ただし、DDDには向かない言語
- 本格的にはJavaやGoなどの静的言語が向いている

---

## アーキテクチャ

**オニオンアーキテクチャ🧅**

**4つの層に役割を分ける：**
- ドメイン層
- インフラ層  
- ユースケース層
- プレゼンテーション層

**ドメイン層はどこにも依存しない**

---

![クリーン(オニオン)アーキテクチャ分かりにくい center width:100% height: 100%](imgs/onion-architecture.jpeg)

---

![オニオンアーキテクチャ center width:100% height: 100%](imgs/ddd-architecture.png)

---

## 完全コンストラクタパターン

**ドメインオブジェクトの実装に使用**

- インスタンス化する際に初期化されていない値の代入を防ぐ
- インスタンス化した時点でオブジェクトが完全な状態
- setterは用意せず、特別なミューテーションメソッドを用意

---

## エンティティとは

**同一判定を識別子で行うもの**

例：人間
- 名前、生年月日、顔が同じでも別人として扱われる
- 現実では戸籍やDNAで判定

エンティティでは **識別子（ID）** で判定
一意であることを示したいので **UUID** が一般的な気がします

---

## 値オブジェクトとは

**同一判定を保持する値で行うもの**

例：お金
- 10円玉を2つ持っている際、その10円玉は同じ10円
- 持っている属性が同じなら同一のものとみなせる

---

## ディレクトリ構成

```
app/
├── controllers/     # プレゼンテーション層
├── domain/          # ドメイン層
│   └── models/      # ドメインオブジェクト
├── infra/           # インフラ層
└── usecase/         # ユースケース層
```

ActiveRecordのファイルが保存されている既存のmodelsディレクトリは使用しない。

---

## 参考資料・引用元
- https://www.domainlanguage.com/ddd/
- https://little-hands.hatenablog.com/entry/2018/12/10/ddd-architecture
- https://little-hands.hatenablog.com/entry/2018/10/08/goal-of-ddd
- https://little-hands.hatenablog.com/entry/2022/06/01/ddd-modeling

---