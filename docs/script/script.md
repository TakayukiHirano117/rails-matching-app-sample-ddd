ページ１

みなさまお集まりいただき誠にありがとうございます！

本日は「ドメインモデリングとコードで理解する実践DDD入門」というテーマでお話ししてまいります！

どうぞよろしくお願いいたします！

ページ２

はじめに改めて自己紹介をします。

フロントエンド推進チームの平野 宇教といいます。

以前は支援開発チームで、IBJS, Leaf, smarry, kana, BN, IBRのタスクをさせていただいていました。

24歳です。今年で25になるのですがその話をすると必ず中村さんに「え、でも今年でアラサーだよね？？(爆笑)」と言われます。

DDDなどの設計やアーキテクチャに特に興味があります。

ページ3
本日の内容
- DDDとは
- なぜDDDなのか
- ドメインモデリングとは
- ドメインモデリングの結果をどうコードに落とすのか

ページ4
さて、「今回はドメイン駆動設計について」ということですが、
IBRではまさにドメイン駆動設計x(スキーマ駆動開発)xオニオンアーキテクチャで
開発をしております。

(トーク)
------------------------
そんなDDDなんですが、みなさんの中でDDDわかる人とか
触ったことがある人ってどれくらいいらっしゃいますか？
DDD触ったけどわからないというか、
専門用語が多すぎてとっつきにくいみたいな人いらっしゃいますか？

私がDDD学び始めて思ったのは、
- 専門用語が多すぎてわかりにくい
- ハンズオン的な教材が少ない
- DDDの雰囲気がなんとなくわかっても実際にどうやってコードに落とせばいいかわからない
ということです。
正直、DDDをしっかり理解するには一つ一つの用語についてある程度理解して
戦術的設計・戦略的設計の両方を理解する必要があるかと思います。

ですが今回は専門用語の説明は必要最低限にして、
なぜDDDなのか、DDDをするとどんな嬉しさがあるのか
をわかってもらって、
なんかDDD楽しそうだな
自分でもDDDできそうだなと思ってもらえる回にしたいと思っておリます。

私自身ドメイン駆動設計を学び始めたのは３ヶ月前と最近なのですが、
DDDの学習・IBRや他の凝集度が低く可読性が低いコードで書かれたプロジェクトでのタスクを通して、
DDDの良さがわかったし、ぜひ今後新しくプロジェクトが作られる時に
DDDのエッセンスを取り入れて欲しいし、
既存のプロジェクトでもDDDの考え方やデザインパターンや
アーキテクチャを用いて改善できると思っているので
ぜひ本日はお付き合いくださいませ！

---------------------

ページ5
では初めに、
今回お話しすることの概要についてお話しします。
今回以下の内容についてお話ししていきます。

- DDDとは
- なぜDDDなのか
- ドメインモデリング入門
- ドメインモデル図をもとにコードに落としてみる(Ruby)


ページ6
次に
「このエンジニアゼミを終えたらできるようになること」
についてお話しします。

このエンジニアゼミを聞くと、

- DDDの戦略的設計・戦術的設計の基礎がわかる
- DDDにおけるエンティティ・値オブジェクトとは何かわかる
- ドメインモデリングの手法がわかる
- ドメインモデル図をもとにしたドメインオブジェクトの実装方法がわかる

ページ7
(もろたでドメイン駆動)
docs/script/imgs/morotadekudou1_R.jpegを表示


ページ8
今回扱わないことについてもお話しします。

- DDDで扱われるアーキテクチャの詳細な内容
- ドメイン層以外の実装について
- テストについて

以上の内容につきましては、今回は扱いません。
あくまでDDDとはどんなものなのか雰囲気を知っていただくのが目的ですので、
ドメイン層以外の実装は次回以降機会があればお話ししたいと思っています。






## DDDとは



ページ9
ではさっそくDDDとは何かからお話ししていきます。

DDDとはずばりソフトウェア設計手法の1つで、
「ある領域に存在する特定の問題を解決することにフォーカスした設計手法」と言えるでしょう。

ソフトウェアというのは何か問題を解決するために作られますが、
ソフトウェアで問題解決しようとする対象領域のことをドメインと呼びます。

ページ10
DDDでは問題解決のために以下のアプローチを取ります。（データモデルではなくドメインモデルのこと。）

（ドメインについての理解を深めモデルを継続的に改善する。）
(モデルを継続的にソフトウェアに反映する。)









## なぜDDDなのか
次になぜDDDなのかということをお話しします。

なぜDDDなのか、要するにDDDをやるとどんな良いことがあるのか、こういう場面でDDDは特に効力を発揮しますよというお話しをそれぞれやっていきます。

DDDをやると以下の様な良いことがあります。

ソフトウェアの
- 機能性
- 保守性

が高まる。

機能性というのは、「ソフトウェアによる問題解決能力、ユーザーの要求を満たす力」のことを指します。
DDDではドメインモデリングを行い、コードに落とし、何か改善点があれば再度ドメインモデリングをしてまたコードに落とすというサイクルを回していきます。
これによって

作ったけど使えないという事態を避けることにつながります。

docs/script/imgs/ddd-approach.pngを表示








## ドメインモデリングとは, マッチングアプリのドメインモデリングを行う
それではドメインモデリングについてお話ししていきます。

ドメインモデリングとは、ドメインモデルを作る作業です。

で、ドメインモデルがなんなのかですが、
📘 出典：Eric Evans『Domain-Driven Design』にはこう記載されています。

*“A model is a system of abstractions that describes selected aspects of a domain and can be used to solve problems related to that domain.”*

（モデルとは、ドメインの特定の側面を抽象化したものであり、そのドメインに関する問題を解決するために使われる。）
です。

例としてメモアプリを考えます。
現実のメモにはメモの内容だけでなく筆跡とか字の大きさとかメモの材質とかがそもそもありますが、ソフトウェアには必要ないし無理(できそうだが)
ソフトウェアで問題と解決するのに必要な情報だけを抽出します。
例えばメモとしてはメモの内容だけあればソフトウェアでは十分ですね。
仮に手書きのメモ機能が欲しいなら手書きできる様にするとかはありだと思います。

こういうふうに、ソフトウェアとして解決したい課題について必要な側面だけを現実の事象から抽出することがドメインモデリングと言います。


ドメインモデリングを行う上で大事なのは、
最初から完璧なものを作ろうとしないことです。
モデリングした結果というのは、
実際にコードに落としてみて動かすまでその良し悪しというのはわからないというか、
完璧なものを作るのは難しいです。
実装して初めて気づくこともあるので、
モデリング→実装→フィードバック→モデリング…というサイクルを周してよりよいものを作るというのが前提だということを把握しておきましょう。


ここではマッチングアプリを題材にして実際にドメインモデリングを行いたいと思います。

モデリングの手法は様々あるのですが、

sudoモデリングというモデリング手法を今回用いようと思います。

sudoモデリングでは、
- system-relation-diagram
- usecase-diagram
- domain-model-diagram
- object-diagram

ドメインモデリングは本来であれば

ドメインエキスパートとともに行います。

ドメインエキスパートとは、

そのドメインに詳しい人のことを指します。

たとえば経費生産システムだったら経理部の人がドメインエキスパートになります。

ではドメインモデリングを行なっていきます。

今回はChatGPTをドメインエキスパートとしてユースケースとかを考えてもらいました。









## ドメインモデリングの結果をコードに落とす。
ページ20
それではドメインモデリングの結果を実際のコードに落としていきたいと思います。
今回扱う技術についてお話しします。

言語はおそらくIBJのエンジニアが最もとっつきやすいであろうRuby, Railsを採用しました。
ただしDDDを行う上ではRuby, Railsは動的言語であるかつインターフェースがないので
正直向かない言語かと思われます。

本格的にやるのであればJavaやGoなどの静的かつインターフェースがある言語の方が
DDD、ひいては複数の層に責務を分離するタイプのアーキテクチャには向いていると思います。

次にアーキテクチャです。
アーキテクチャは今回オニオンアーキテクチャを使用します。

オニオンアーキテクチャは、
ドメイン層、インフラ層、ユースケース層、プレゼンテーション層の4つの層に役割を分けて、
ドメイン層はどこにも依存しないようにするアーキテクチャです。

オニオンアーキテクチャはドメイン層が変更されることによって他の層に影響が及ぶ、まさにドメインに駆動するアーキテクチャのためDDDでよく用いられます。


次にデザインパターンについてもお話しします。
今回ドメインオブジェクト(ドメインを表現したクラス)の実装に
完全コンストラクタパターンを使用します。

完全コンストラクタパターンとは、
インスタンス化する際に初期化されていない値の代入を防ぎ、
インスタンス化した時点でオブジェクトが完全な状態であることを担保するデザインパターンを指します。
さらに、setterは用意せず、状態を変化させるための特別なミューテーションのメソッドを用意し、
一度インスタンス化されたらミューテーションのメソッドを介さないと状態を変化できない様に強制します。

# 初期化されていない値がある状態で後でsetterで値を入れている実装例を示したい

この完全コンストラクタパターンを用いて、
ドメインオブジェクトであるエンティティ・値オブジェクトを実装します。


エンティティとは
同一判定を識別子で行うもの。可変になりうる、不変としても良い。

わかりやすい例を示すと、
ここに〇〇さんがいますね？
この世に仮に名前も生年月日も顔も同じ〇〇さんがいたとしてもそれは別物として扱われます。
これがエンティティだと思ってください。
現実世界ではこれをたぶん戸籍とかDNAとかなんかで判定しますが、
エンティティはこれを識別子、IDで判定します。

値オブジェクトとは
同一判定を保持する値で行うもの。絶対に不変。
所持金を表すとき、10円玉を2つ持っている際にその10円玉はおなじ10円と見なすことができます。
（これが令和〇〇年と平成〇〇年のものと区別する様なコインコレクター用アプリでない限りは）
このように持っている属性が同じなら同一のものとみなせるものを値オブジェクトまたはバリューオブジェクトといいます。


ディレクトリ構成については、
app/domainディレクトリをドメイン層として、
この配下にmodelsディレクトリを作成してドメインオブジェクトを作成していきます。




## 引用・参考資料
https://www.domainlanguage.com/ddd/
https://little-hands.hatenablog.com/entry/2018/12/10/ddd-architecture
https://little-hands.hatenablog.com/entry/2018/10/08/goal-of-ddd
https://little-hands.hatenablog.com/entry/2022/06/01/ddd-modeling